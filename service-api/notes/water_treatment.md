Приветствую всех!
Пожалуй, самой закрытой технологией в пользовательском сегменте является сотовая связь. Очень немногие знают о том, как на самом деле работают телефоны и модемы, отчего им часто приписывают всякие мифические свойства. Как насчёт попробовать запустить полностью открытую реализацию модема стандарта 4G? Именно этим я и предлагаю заняться.



Итак, в сегодняшней статье поговорим о том, как взаимодействовать с мобильной сетью при помощи SDR. Попутно узнаем, какой софт для этого существует, и соберём самый дорогой 4G-модем в истории.

Традиционно будет много интересного.

❯ Суть такова

В начале года я рассматривал запуск домашней сети 4G на базе софта srsRAN и подключал к ней обычные телефоны. Сегодня мы посмотрим на эту задачу с противоположной стороны — создадим устройство, которое будет видеть сеть оператора и получать от неё данные. А заодно и подключим компьютер к мобильному интернету без использования заводского телефона или модема.

❯ Что за софт мы будем использовать?

Как я уже говорил, открытая реализация 4G не одна. Но по части «пользовательских» устройств всё несколько беднее — есть софт GR-LTE (который, правда, служит для декодирования сигналов LTE, а не для работы с сетью), а также srsUE от всё того же Software Radio Systems (srsRAN). Последний нам и нужен: это полноценная софтовая реализация LTE-модема. Изначально это ПО предназначалось для совместной работы с srsENB, то есть предполагалось, что у вас есть два ПК, на одном из которых запущена БС (eNodeB), а на другом — абонентское устройство (User Equipment). Такая связка позволяет анализировать всю работу сети полностью. Но второго SDR у меня нет, так что поговорим о самом интересном: как подключиться при помощи этого софта к обычной сети и, на этот раз, раздать интернет на компьютер.

Если у вас нет SDR, то можно воспользоваться эмулятором БС, который также описан на сайте srsRAN.

Внимание!
В данной статье описывается взаимодействие с коммерческими сотовыми сетями. Правильно настроенный софт никак не мешает их работе, но вы в любом случае должны иметь представление о том, что собираетесь сделать.

❯ Что нужно, чтобы запустить эмулятор модема?

Самое время определиться с оборудованием. Итак, для проведения опытов понадобится примерно следующий набор:

Компьютер с Linux. Как и в прошлых опытах, машина должна быть достаточно мощной, чтобы обрабатывать данные с SDR. Также обязателен порт USB 3.0.
SDR. Именно из-за него статья имеет класс «Сложный», так как подобные устройства весьма дороги и есть не у всех. Подойдут всё те же модели, что годятся для eNodeB: USRP, BladeRF или любой другой, совместимый с драйвером SoapySDR. Также srsRAN можно пересобрать под LimeSDR, но ввиду того, что такого девайса у меня нет, я не интересовался, как это сделать.
Антенны для SDR. В идеале — те, которые специально рассчитаны на использование в сетях 3G/4G.
Симка. Лучше, если их будет несколько, разных операторов, так как с какими-то работает стабильно, а с какими-то — не очень. Само собой, карта должна быть живая и с ненулевым балансом.
Считыватель смарт-карт. Обязательно совместимый со стандартом PC/SC, иначе работать не будет. Всякие китайские «SIM card reader» с проприетарным софтом не подойдут.
Телефон. Непосредственно в запуске он участия принимать не будет, но для подготовки понадобится.

GPS-DO или другой подобный источник стабильной частоты, в отличие от БС, использовать необязательно.

❯ Обзор оборудования

image

Перво-наперво идёт, конечно, сам SDR — USRP B200mini-i и комплект антенн к нему.

image

Считыватель.





Такой экземпляр можно встретить в любом месте, где есть какие-то СКЗИ или авторизация по смарт-карте, то есть практически повсеместно. Если под рукой такого нет, его можно легко купить, благо стоит он всего-ничего.





А вот пример тех, которые не подойдут — пин-пады со считывателями карт, а также проприетарные девайсы.

В общем-то, больше ничего примечательного сегодня не потребуется.

❯ Ставим софт

По умолчанию srsUE не поддерживает работу со считывателем смарт-карт, поэтому его необходимо пересобрать из исходников. Именно этим мы сейчас и займёмся.
Для начала устанавливаем зависимости:

sudo apt-get install build-essential cmake libfftw3-dev libmbedtls-dev libboost-program-options-dev libconfig++-dev libsctp-dev
sudo apt-get install libpcsclite-dev pcscd pcsc-tools

Для запуска я рекомендую использовать дистрибутив DragonOS. Там уже установлены все необходимые зависимости. В случае использования именно его первую строчку надо пропустить. Второй строчкой устанавливаем библиотеки и софт для работы со смарт-картами.

Теперь клонируем и собираем: